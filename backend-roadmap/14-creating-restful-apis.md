# 14. Creating RESTful APIs

## 目標

REST アーキテクチャスタイルを理解し、RESTful API を実装できるようになる。

## 目次

- [REST とは](#REST-とは)
- [REST を構成するアーキテクチャスタイル](#REST-を構成するアーキテクチャスタイル)
- [RESTful API を作成する](#RESTful-API-を作成する)

## REST とは

REST（REpresentational State Transfer）

> RESTはWebのアーキテクチャスタイルです。  
アーキテクチャスタイルは別名「(マクロ)アーキテクチャパターン」とも言い、
複数のアーキテクチャに共通する性質、様式、作法あるいは流儀を差す言葉です。

> 素のクライアント/サーバアーキテクチャスタイルにいくつかの制約を加えていくと、RESTというアーキテクチャスタイルになります。

source: 山本陽平, Web を支える技術, P.25 ~ P.26

> REST は複数のアーキテクチャスタイルを組み合わせて構築した複合アーキテクチャスタイルです。

source: 山本陽平, Web を支える技術, P31

## REST を構成するアーキテクチャスタイル

### クライアント / サーバ

- HTTP でクライアントとサーバが通信するスタイル
- クライアントのマルチプラットフォーム化
- サーバを増やすことで可用性の向上

### ステートレスサーバ

- クライアントのアプリケーション状態を管理しないサーバ
- サーバ側の実装を簡略化できる
- Cookie を使ったセッション管理はステートフル

### キャッシュ

- 一度取得したリソースをクライアント側で使い回す方式
- クライアント・サーバ間の通信を減らすことで、より効率的に処理できる

### 統一インターフェース

- URI で指し示したリソースに対する操作を、統一した限定的なインターフェースで行うスタイル

| メソッド | 振る舞い |
| --- | --- |
| GET | リソースの表現を取得する |
| POST | リソースを作成する |
| PATCH | リソースを部分変更する |
| PUT | リソースを変更する |
| DELETE | リソースを削除する |

- 通信が単純化され、通信の可視性、クライアントとサーバの実装の独立性が向上する

### 階層化システム

- いくつかの階層にシステムを分離するアーキテクチャスタイル
- ロードバランサを配置したり、プロキシを配置したり、AP / DB サーバを配置したり
- レガシーシステムの前に web サーバを挟むことでブラウザなどと接続できる
- クライアントからはシステムの詳細を意識する必要はない

### コードオンデマンド

- プログラムをサーバからダウンロードし、クライアント側でそれを実行するアーキテクチャスタイル
  - e.g. JavaScript
- クライアントの拡張性の向上
- クライアント・サーバ間でやりとりされるリソースが不明確になる

> RESTはアーキテクチャスタイルなので、実際にシステム(Webサービスもそれ以外も含む)を設計する際はそのシステムのアーキテクチャを作らなければなりません。RESTに基づいたアーキテクチャを構築する場合でも、RESTを構成するスタイルのうち、いくつかを除外しても構いません。たとえば、ステートフルではあるけれど、そのほかはRESTの制約に従っているアーキテクチャも考えられます。

source: 山本陽平, Web を支える技術, P.37

つまり、実際のシステムに合ったアーキテクチャスタイルを選択することを念頭に置きながら、実際に価値を提供できるシステムを開発することが重要。

また、REST に則って設計されていることを **RESTful** である、と言う。

## RESTful API を作成する

No.11 のブログアプリと同機能の RESTful API を作成する。

[制作物リンク](https://github.com/kazu-horie/rails-blog-api)
  - [API 設計書 兼 API クライアント - Swagger](https://github.com/kazu-horie/rails-blog-api/blob/master/docs/swagger.yaml)
  - [CORS 対応](https://github.com/cyu/rack-cors#rails-configuration)

## REST 原則のチェック

### 参考

- [Webを支える技術, 山本陽平 著](https://gihyo.jp/magazine/wdpress/plus/978-4-7741-4204-3)
- [Qiita@uneosy - RESTful API設計におけるHTTPステータスコードの指針](https://qiita.com/uenosy/items/ba9dbc70781bddc4a491)
- [HTTP レスポンスステータスコード](https://developer.mozilla.org/ja/docs/Web/HTTP/Status)
